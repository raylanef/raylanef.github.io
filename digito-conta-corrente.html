<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- CSS only -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">
    <!-- JavaScript Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3"
        crossorigin="anonymous"></script>
    <title>Validador Bancário</title>
</head>

<body class="bg-ligth bg-gradient d-flex flex-column min-vh-100">
    <nav class="navbar bg-secondary bg-opacity-10 mb-4">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-bank"
                    viewBox="0 0 16 16">
                    <path
                        d="m8 0 6.61 3h.89a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-.5.5H15v7a.5.5 0 0 1 .485.38l.5 2a.498.498 0 0 1-.485.62H.5a.498.498 0 0 1-.485-.62l.5-2A.501.501 0 0 1 1 13V6H.5a.5.5 0 0 1-.5-.5v-2A.5.5 0 0 1 .5 3h.89L8 0ZM3.777 3h8.447L8 1 3.777 3ZM2 6v7h1V6H2Zm2 0v7h2.5V6H4Zm3.5 0v7h1V6h-1Zm2 0v7H12V6H9.5ZM13 6v7h1V6h-1Zm2-1V4H1v1h14Zm-.39 9H1.39l-.25 1h13.72l-.25-1Z" />
                </svg>
                Validador Bancário
            </a>
        </div>
    </nav>
    <div class="container text-center ps-2">
        <ul class="nav nav-tabs">
            <li class="nav-item">
                <a class="nav-link active" href="#">Dígito Conta Corrente</a>
            </li>
        </ul>
        <div class="container col-8 mt-4">
            <select class="form-select" id="select-banco" aria-label="Default select example">
                <option selected value="0">Selecione o banco</option>
                <option value="1">
                    <img src="./image.svg" style="width:30px;height:30px;margin-right:5px;" /> Banco do Brasil</option>
                <option value="2">Bradesco</option>
                <option value="3">Caixa Econômica</option>
                <option value="4">Itaú</option>
            </select>
            <div class="row g-2 mt-4">
                <div class="alert alert-danger" id="alerta-agencia" role="alert" style="display: none;">
                </div>
                <div class="col-md">
                    <div class="form-floating">
                        <input type="text"  class="form-control" id="input-agencia">
                        <label for="floatingInputGrid">Agência</label>
                    </div>
                </div>
                <div class="col-md">
                    <div class="form-floating">
                        <input type="text" class="form-control" id="input-conta-corrente">
                        <label for="floatingInputGrid">Conta Corrente</label>
                    </div>
                </div>
            </div>
            <div class="d-grid gap-2 col-12 mx-auto mt-4">
                <button type="button"  class="btn btn-dark" onclick="descobreDigitoVerificadorConta()">Verificar</button>
            </div>
            <div class="alert alert-success mt-4" id="resposta" role="alert" style="display: none;">
            </div>
        </div>
    </div>




</body>
<script>
    function descobreDigitoVerificadorConta() {
        let selectBox = document.getElementById("select-banco").value;
        let contaCorrente = document.getElementById("input-conta-corrente").value;
        let agencia = document.getElementById("input-agencia").value;
        let arrayConta = contaCorrente.split("");
        let arrayAgencia = agencia.split("");
        apagaPosicaoVazia(arrayConta);
        apagaPosicaoVazia(arrayAgencia);
        let digitoVerificador;



        if (selectBox == 1) {
            digitoVerificador = verificaDigitoBancoBrasil(arrayConta);
        }

        if (selectBox == 2) {
            digitoVerificador = verificaDigitoBradesco(arrayConta);
        }

        let agenciaValida = validaInputAgenciaAlertaAgencia(arrayAgencia,4);
        

        if (agenciaValida && selectBox == 3) {
            digitoVerificador = verificaDigitoCaixa(arrayConta, arrayAgencia);
        }

        if (agenciaValida && selectBox == 4) {
            digitoVerificador = verificaDigitoItau(arrayConta, arrayAgencia);
        }

        resposta(digitoVerificador);

    }

    function verificaDigitoBradesco(arrayConta) {
        arrayConta = arrayConta.length < 8 ?
            adicionaNumerosNaConta(8, arrayConta) : arrayConta;
        console.log(arrayConta);
        let arrayMultiplicadores = [3, 2, 7, 6, 5, 4, 3, 2];
        let somaTotal = somaNumeros(arrayConta, arrayMultiplicadores);
        console.log("Soma total: " + somaTotal);
        let modulo = (somaTotal % 11);
        if (modulo == 0) return 0;
        if (modulo == 1) return "P";
        return (11 - modulo);
    }

    function verificaDigitoBancoBrasil(arrayConta) {
        let arrayMultiplicadores = [9, 8, 7, 6, 5, 4, 3, 2];
        arrayConta = arrayConta.length < 8 ?
            adicionaNumerosNaConta(8, arrayConta) : arrayConta;
        let somaTotal = somaNumeros(arrayConta, arrayMultiplicadores);
        let modulo = 11 - (somaTotal % 11);
        if (modulo == 10) return 0;
        if (modulo == 11) return "X";
        return modulo;
    }

    function verificaDigitoCaixa(arrayConta, arrayAgencia) {
        let arrayMultiplicadores = [8, 7, 6, 5, 4, 3, 2, 9, 8, 7, 6, 5, 4, 3, 2];
        arrayConta = arrayConta.length < 11 ?
            adicionaNumerosNaConta(11, arrayConta) : arrayConta;
        let arrayFinal = arrayAgencia.concat(arrayConta);

        let somaTotal = somaNumeros(arrayFinal, arrayMultiplicadores);
        let somaFinal = (somaTotal * 10);
        let modulo = parseInt((somaFinal / 11), 10) * 11;
        let valorFinal = somaFinal - modulo;
        if (valorFinal == 10) return 0;
        return valorFinal;
    }

    function verificaDigitoItau(arrayConta, arrayAgencia) {
        let somaTotal = 0;
        let arrayMultiplicadores = [2, 1, 2, 1, 2, 1, 2, 1, 2];
        arrayConta = arrayConta.length < 5 ?
            adicionaNumerosNaConta(5, arrayConta) : arrayConta;
        let arrayFinal = arrayAgencia.concat(arrayConta);
        for (i = 0; i < arrayFinal.length; i++) {
            let numero = parseInt(arrayFinal[i]) * arrayMultiplicadores[i];
            console.log(numero);
            somaTotal += numero > 9 ? splitInteiro(numero) : numero;

        }
        let valorFinal = 10 - (somaTotal % 10);
        if (valorFinal == 10) return 0;
        return valorFinal;

    }


    function splitInteiro(numero) {
        return parseInt((numero / 10), 10) + numero % 10;
    }

    function apagaPosicaoVazia(array) {
        let posicaoVazia = " ";
        let indice = array.indexOf(posicaoVazia);
        while (indice >= 0) {
            array.splice(indice, 1);
            indice = array.indexOf(posicaoVazia);
        }
    }

    function adicionaNumerosNaConta(qtdNumerosConta, arrayConta) {
        for (i = qtdNumerosConta - arrayConta.length; i > 0; i--) {
            arrayConta.unshift(0);
        }
        console.log("Passou no adiciona: " + arrayConta);
        return arrayConta;
    }

    function somaNumeros(arrayFinal, arrayMultiplicadores) {
        let soma = 0;
        for (i = 0; i < arrayFinal.length; i++) {
            soma += parseInt(arrayFinal[i]) * arrayMultiplicadores[i];
            console.log(soma)
        }
        return soma;
    }

    function validaInputAgenciaAlertaAgencia(arrayAgencia, digitosAgencia) {
        if (arrayAgencia.length < digitosAgencia) {
            let alerta = document.getElementById('alerta-agencia');
            alerta.style.display = 'block';
            alerta.innerHTML = "É necessário preencher o campo Agência !"
            return false;
        }
        return true;
    }

    function resposta(digitoVerificador){
        if(digitoVerificador != undefined){
        let alerta = document.getElementById('alerta-agencia').style.display = 'none';
        let resposta = document.getElementById('resposta');
        let selectBox = document.getElementById("select-banco");
        let contaCorrente = document.getElementById("input-conta-corrente");
        let agencia = document.getElementById("input-agencia");
        resposta.style.display = 'block';
        resposta.innerHTML = "O dígito da conta corrente informada é " + digitoVerificador;
        selectBox.value = 0;
        contaCorrente.value = " ";
        agencia.value = " ";
        }
    }

    function zeraTodosOsCampos(){
        let alerta = document.getElementById('alerta-agencia').style.display = 'none';
        let resposta = document.getElementById('resposta').style.display = 'none';
        let selectBox = document.getElementById("select-banco");
        let contaCorrente = document.getElementById("input-conta-corrente");
        let agencia = document.getElementById("input-agencia");
        selectBox.value = 0;
        contaCorrente.value = " ";
        agencia.value = " ";
    }

</script>

</html>